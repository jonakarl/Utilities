#!/bin/bash
set -e

# generate a unique static IP for each interface name metadata is .0.1
# $1 - interface name (e.g wwan0)
# $2 - IP range to map to (e.g 172.18)

IF=$1
VETH_IPRANGE=$2
if [ ! -f /tmp/monroe-ifnum.db ];then
  touch /tmp/monroe-ifnum.db
fi

NUM=$(grep "$IF:" /tmp/monroe-ifnum.db|cut -f2 -d":")
if [ -z "$NUM" ];then
 NUM=$(wc -l /tmp/monroe-ifnum.db|cut -f1 -d' ')
 echo "$IF:$NUM" >> /tmp/monroe-ifnum.db
fi
echo  "$VETH_IPRANGE.$NUM"
